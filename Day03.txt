计算机网络_day03
2022/2/9

1.数据链路层

	―― 该层信道类型:点对点信道和广播信道

	―― 链路【一条路径的组成部分】

		* 定义:从一个节点到相邻节点的一段物理线路(有线或无线)【中间没有任何其他的交换节点】

		* 数据链路:实现控制数据传输的协议的硬件和软件与链路的总和

	―― 三大重要问题

		* 封装成帧

			―― 定义:在一段数据的前后分别添加首部和尾部，构成一个帧

			―― 首尾部作用
				
				① 帧定界

				② 包含必要的控制信息

			―― 最大传送单元MTU:所能传送的帧的数据部分长度上限【注意，是数据部分而非帧整体】

		* 透明传输

			―― 定义:发送方发送什么，接收方就能收到什么

			―― 方法【针对数据部分出现的相关内容】

				* 字节填充【也称字符填充】

					―― 实现:在对应字符前面插入一个转义字符"ESC"【并非是三个字母ESC，而是编码内容对应为ESC】

					―― 特殊情况:如果数据部分有内容为ESC，则在ESC前面插入"ESC"

					―― 原理:在接收端收到数据时，就会删除数据前面的转义字符

				* 零比特填充

					―― 实现:发现有5个连续的比特1，则立即在后面填入一个比特0

					―― 原理:接收端收到数据时，每接收5个连续的比特1就会剔除后面的一个比特0

		* 差错检测

			―― 比特差错:比特在传输过程中可能会产生差错，1变为0，而0变为1

			―― 误码率BER:一段时间内，传输错误的比特占所传输比特总数的比率

			―― 检测方法

				* 奇偶校验

					―― 实现:在待发送的数据后面添加1位奇偶校验位，使整个数据中(包括奇偶校验位)的比特1为奇数【奇校验】或偶数【偶校验】

					―― 局限:当比特1的奇偶性发生改变才可检查出错误【如果奇偶性未改变，可能发生漏检】

				* 循环冗余检验CRC

					―― 实现

						① 收发双方约定好一个生成多项式G(x)

						② 发送方基于待发送的数据和生成多项式计算出差错检测码(冗余码)，将其添加到带传输数据的后面一起传输

						③ 接收方通过生成多项式来计算收到的数据是否产生了误码

					―― 固定要求:必须包含常数项

					―― 计算步骤

						* 发送方

							① 构造被除数:待发送数据后面添加与生成多项式最高次数一样的0

							② 构造除数:生成多项式各项的系数构成的比特串

							③ 做"除法"【采用异或运算，一开始先记1运算，而后出现余数；将被除数对应位置的比特数落下，若位数不够记0继续落，若位数足够记1运算】

							④ 检查余数:余数的位数应与生成多项式最高次数相同，如果不够则用0来补足

						* 接收方

							① 构造被除数:接收到的数据就是被除数

							② 构造除数:生成多项式各项的系数构成的比特串

							③ 做"除法"

							④ 检查余数:余数为0，则无误码；余数不是0，则出现误码

					―― 帧检验序列FCS:用于检错的冗余码

2.点对点协议PPP【数据链路层的协议】

	―― 组成

		* 将IP数据报封装到串行链路的方法

		* 链路控制协议LCP

		* 网络控制协议NCP
	
	―― 帧格式

		* 帧首第一字段、帧尾第二字段:标志字段F【定界符】，取值为0x7E

		* 帧首第二字段:地址字段A，取值为0xFF【暂无具体功能】

		* 帧首第三字段:控制字段C，取值为0x03【暂无具体功能】

		* 帧首第四字段:协议字段【指明帧的数据部分送交哪个协议处理】

			取值为0x0021，帧的数据部分为IP数据报

			取值为0xC021，帧的数据部分为LCP分组

			取值为0x8021，真的数据部分为NCP分组

		* 帧尾第一字段:帧检验序列FCS【检测误码】
		
	―― 关于实现透明传输

		* 面向字节的异步链路【字节填充法】

			―― 发送方

				① 将数据部分出现的每一个0x7E(PPP帧的定界符)字节转变为2字节序列(0x7D，0x5E)

				② 将数据部分出现的每一个0x7D(转义字符)字节转变为2字节序列(0x7D，0x5D)

				③ 将数据部分出现的每一个ASCII码控制字符(数值小于0x20的字符)，在该字符前面插入一个0x7D字节，同时将该字符的编码加上0x20

			―― 接收方:进行反变换以恢复数据

		* 面向比特的同步链路【比特填充法】

			―― 五一添零

3.广播信道【共享信道】

	―― 媒体接入控制MAC

		* 静态划分信道【应用范围:物理层】

			―― 特点:预先固定分配好信道，不灵活，对于突发性数据传输信道利用率较低

			―― 复用:通过一条物理线路同时传输多路用户的信号

			―― 复用器与分用器成对存在

			―― 频分复用FDM

				* 实现:所有用户同时占用不同频带资源并行通信

			―― 时分复用TDM

				* 实现:所有用户在不同的时间内占用同样的频带宽度

			―― 波分复用WDM

				* 实现:一根光纤同时传输多个频率相近的光载波信号，使光纤传输能力成倍提高

			―― 码分复用CDM

				* 特点:该系统发送的信号具有很强的抗干扰能力，频谱类似于白噪声

				* 码分多址CDMA:码分复用信道为多个不同地址的用户所共享

				* 码片:在CDMA中，每一个比特时间再划分为m个短的间隔

				* 每个站都会指派一个唯一的m bit码片序列

					―― 一个站如果要发送比特1，则发送它自己的m bit码片序列

					―― 一个站如果要发送比特1，则发送它自己的m bit码片序列的二进制反码

				* 规定:两个不同站S和T的码片序列正交，则他们的规格化内积为0【S・T=(1/m)Σ S×T=0】

					―― 特别地，S・S=1；S・非T=0；S・非S=-1

		* 动态接入控制

			―― 受控接入

				* 集中控制

					―― 特点:单个主站循环轮询每个站点有无数据发送，被访问到的站点才可发送数据，存在单点故障问题

				* 分散控制

					―― 特点:各站点构成一个环形网络，令牌沿环逐站传递，接收到令牌的站点才有权发送数据，发送完毕后令牌传递给下一站点

			―― 随机接入【以太网】【半双工通信】

				* 特点:所有站点通过竞争，随机地发送数据

				* 载波监听多址接入/碰撞检测 CSMA/CD【适用场景:总线局域网】

					―― 载波监听CS:每个站再发送帧之前先检测一下总线上是否有其他站点在发送帧【先听后说】

						* 若检测到总线空闲96bit时间，则发送帧

						* 若检测总线忙，则继续检测并等待总线转为空闲96bit时间，再发送帧

					―― 多址接入MA:多个站连接在一条总线上，竞争使用总线

					―― 碰撞检测CD:每个发送帧地站边发送边检测碰撞【边说边听】

						* 一旦发现总线上发送碰撞，则停止发送，伺机而动
					
					*―― 电磁波在1km电缆地传播时延约为5μs

					―― 单程端到端地传播时延τ【假设A，B两端进行数据发送】

						* t=0时，A发送数据；B检测到信道为空闲

						* t=τ-δ时(τ>δ>0)，A发送的数据还没到达B，而B由于检测到信道空闲开始发送数据

						* t=τ-δ/2时，A发送的数据与B发送的数据发生碰撞，但此时A和B还未得知发生碰撞的消息

						* t=τ时，B检测到碰撞，于是停止发生数据

						* t=2τ时，A也检测到碰撞，于是停止发生数据【由此，规定2τ为争用期/碰撞窗口】

					―― 最小帧长:以太网规定为512比特即64字节【小于64字节的帧都视为无效帧】

					―― 截断二进制指数退避算法:退避时间=基本退避时间(争用期2τ)×随机数r【r~{0,1,...,2^k-1},k~min[重传次数,10]】
						
						* 当重传多达16次时，丢弃该帧

					―― 信道利用率【理想条件下，不考虑争用期】

						* 计算:极限信道利用率Smax=1/(1+a)【a=τ/T0】

				* 载波监听多址接入/碰撞避免 CSMA/CA【适用场景:无线局域网】【802.11在使用CSMA/CA的同时还使用了停止/等待协议】

					―― 帧间间隔IFS

						* 定义:802.11规定，所有的站点必须在连续检测到信道空闲一段指定时间后才能发送帧，这段时间便是IFS

						* 帧间间隔长短【取决于发送帧的类型】

							―― 高优先级需要等待的时间较短，可优先获得发送权

							―― 低优先级需要等待的时间较长

						* 分类

							―― 短帧间间隔SIFS(28μs):最短的帧间间隔，用于分隔开是属于一次对话的各帧【eg:ACK帧、CTS帧...】

							―― DCF帧间间隔DIFS(128μs):在DCF方式中用于发送数据帧和管理帧
						
					―― CSMA/CA协议的退避算法

						* 使用条件

							① 在发送数据帧之前检测到信道处于忙状态

							② 在每一次重传一个数据帧时

							③ 在每一次成功发送后要连续发送下一帧时【避免一个站点长时间占用信道】

						* 步骤

							① 在执行退避算法时，站点为退避计时器设置一个随机的退避时间

							② 当退避时间减小到零时，开始发送数据

							③ 当退避时间还未减小到零时信道便又转为忙状态，这时就冻结退避时间，重新等待信道变为空闲，再经过时间DIFS后继续启动退避计时器

					―― CSMA/CA协议的信道预约

						* 描述:为了尽可能减少碰撞概率和降低碰撞的影响，802.11标准允许要发送数据的站点对信道进行预约【通过请求发送帧RTS和允许发送帧CTS】

					―― CSMA/CA协议的虚拟载波监听【减少隐蔽站带来的碰撞问题】

						* 描述:站点只要监听到RTS帧、CTS帧或数据帧中的任意一个就可知道信道将被占用的持续时间

4.以太网的MAC层

	―― MAC地址(物理地址/硬件地址):以太网的MAC子层所使用的地址【数据链路层】

		* MAC地址是对网络上各接口的唯一标识，而不是对网络各设备的北医标识

		* 三类帧

			―― 单播帧

			―― 广播帧

			―― 多播帧

				* 判断多播地址:该位十六进制数不能整除2(1,3,5,7,9,B,D,F)，即为多播地址

5.集线器与交换机

	―― 集线器

		* 只工作在物理层【每个接口仅简单地转发比特，不进行碰撞检测】

		* 有少量地容错能力和网络管理功能

		* 半双工通信

		* 扩大范围的结果:扩大了广播域，也扩大了碰撞域

	―― 交换机

		* 双工通信

		* 内部地帧交换表是通过自学习算法自动地逐渐建立起的

		* 扩大范围的结果:扩大了广播域，隔离碰撞域

6.以太网交换机

	―― 自学习过程:先盲目泛洪地集体发送，慢慢记录[MAC地址与接口的对应关系]，后再明确地单个发送

	―― 转发过程:交换机收到帧后，在帧交换表中查找帧地目的MAC地址所对应的接口号，通过该接口发送信号

	―― 生成树协议STP

		* 相关问题:网络环路

			―― 广播风暴

			―― 主机收到大量的广播帧你

			―― 交换机的帧交换表振荡(漂移)
		
		* 实现:不改变网络的实际拓扑，但在逻辑上切断某些链路，使得逻辑上不存在环路【拓扑结构必须是树型的】

7.虚拟局域网VLAN

	―― 作用:把较大的局域网分割为多个较小的局域网，每个局域网是一个较小的广播域

	―― 实现【关键:VLAN标识符VID】

		* 打标签:当交换机收到普通的以太网帧时，会将其插入4字节的VLAN标记转变为802.1Q帧

		* 去标签:当交换机转发802.1Q帧时，可能删除其4字节的VLAN标记转变为普通帧

	―― 

